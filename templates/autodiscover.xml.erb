<?php header("Content-type: text/xml"); ?>
<?php
   //Lese den Body der XML-Anfrage von Outlook aus
   $xmlObj = simplexml_load_string(file_get_contents('php://input'));
   //Suche in der XML-Antwort die E-Mailadresse raus
   $arraydata = (array) $xmlObj;
   $arraydata = (array) $arraydata["Request"];
   $email = $arraydata["EMailAddress"];
   $mailserver = '<%= @email_fqdn -%>';
?>

<Autodiscover xmlns="http://schemas.microsoft.com/exchange/autodiscover/responseschema/2006">
<Response xmlns="http://schemas.microsoft.com/exchange/autodiscover/outlook/responseschema/2006a">
  <Account>
    <AccountType>email</AccountType>
    <Action>settings</Action>
    <Protocol>
      <Type>IMAP</Type>
      <Server><?php echo $mailserver ?></Server>
      <LoginName><?php echo $email ?></LoginName>
      <Port>993</Port>
      <DomainRequired>off</DomainRequired>
      <SPA>off</SPA>
      <SSL>on</SSL>
      <AuthRequired>on</AuthRequired>
    </Protocol>
    <Protocol>
      <Type>POP3</Type>
      <Server><?php echo $mailserver ?></Server>
      <LoginName><?php echo $email ?></LoginName>
      <Port>995</Port>
      <DomainRequired>off</DomainRequired>
      <SPA>off</SPA>
      <SSL>on</SSL>
      <AuthRequired>on</AuthRequired>
    </Protocol>
    <Protocol>
      <Type>SMTP</Type>
      <Server><?php echo $mailserver ?></Server>
      <LoginName><?php echo $email ?></LoginName>
      <Port>465</Port>
      <DomainRequired>off</DomainRequired>
      <SPA>off</SPA>
      <SSL>on</SSL>
      <AuthRequired>on</AuthRequired>
      <UsePOPAuth/>
      <SMTPLast>off</SMTPLast>
    </Protocol>
  </Account>
</Response>
</Autodiscover>

